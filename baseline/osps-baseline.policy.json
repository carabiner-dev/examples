{
    "id": "OSPS",
    "policies": [
        {
            "id": "OSPS-AC-01",
            "meta": {
                "description": "The project's version control system MUST require multi-factor authentication that does not include SMS ",
                "assert_mode": "AND",
                "enforce": "OFF",
                "controls": [
                    { "class": "OSPS", "id": "AC-01" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "github.orgDescriptorFromURI(predicate.data.materials[0].uri)"
                    }
                }
            ],
            "identities": [
                {
                    "sigstore": {
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                    }
                }
            ],
            "tenets": [
                {
                    "code": "outputs[\"members\"].all(member, member.hasTwoFactorEnabled)",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/mfa.yaml"]
                    },
                    "outputs": {
                        "members": {
                            "code": "has(predicates[0].data.values.data.organization.membersWithRole) ? (has(predicates[0].data.values.data.organization.membersWithRole.edges) ? predicates[0].data.values.data.organization.membersWithRole.edges : false) : false"
                        }
                    },
                    "assessment": {
                        "message": "Multi-factor authentication is enabled for all members in the organization"
                    },
                    "error": {
                        "message": "Multifactor authentication is not enabled for some members",
                        "guidance": "Enable MFA in the GitHub organization settings to force all members to turn it on"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-AC-03",
            "meta": {
                "description": "The project's version control system MUST require multi-factor authentication that does not include SMS ",
                "assert_mode": "AND",
                "controls": [
                    { "class": "OSPS", "id": "AC-03" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "github.branchDescriptorFromURI(predicate.data.materials[0].uri, \"main\")"
                    }
                }
            ],
            "identities": [
                {
                    "sigstore": {
                        "mode": "exact",
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                   }
                }
            ],
            "tenets": [
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    },
                    "assessment": {
                        "message": "Found attested branch protection metadata"
                    }
                },
                {
                    "id": "01",
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"deletion\") : false",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    },
                    "assessment": {
                        "message": "Force pushing is disabled on default branch"
                    },
                    "error": {
                        "message": "Force pushes can be sent to main branch",
                        "guidance": "Create a branch ruleset protecting your default branch and enable \"Block force pushes\""
                    }
                },
                {
                    "id": "02",
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"deletion\") : false",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    },
                    "assessment": {
                        "message": "Branch deletion is disabled on default branch"
                    },
                    "error": {
                        "message": "Branch delete protection is not enabled",
                        "guidance": "Create a branch ruleset protecting your default branch and enable \"Restrict deletions\""
                    }
                }                
            ]            
        },
        {
            "id": "OSPS-GV-02",
            "meta": {
                "description": "The project MUST have one or more mechanisms for public discussions about proposed changes and usage obstacles.",
                "assert_mode": "AND",
                "controls": [
                    { "class": "OSPS", "id": "GV-02" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "github.repoDescriptorFromURI(predicate.data.materials[0].uri)"
                    }
                }
            ],
            "identities": [
                {
                    "sigstore": {
                        "mode": "exact",
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                   }
                }
            ],
            "tenets": [
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/repo.yaml"]
                    },
                    "assessment": {
                        "message": "Found attested repository data"
                    }
                },
                {
                    "id": "01",
                    "code": "outputs[\"issues\"]",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/repo.yaml"]
                    },
                    "outputs": {
                        "issues": {
                            "code": "has(predicates[0].data.values.has_issues) ? predicates[0].data.values.has_issues : false"
                        }
                    },
                    "assessment": {
                        "message": "Issues feature is enabled in the repository"
                    },
                    "error": {
                        "message": "Issues are not enabled in the repo",
                        "guidance": "Turn on the issues setting in the repository"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-GV-03",
            "meta": {
                "description": "The project documentation MUST include an explanation of the contribution process.",
                "enforce": "OFF",
                "controls": [
                    { "class": "OSPS", "id": "GV-03" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "id": "01",
                    "code": "size(outputs[\"files\"]) > 0",
                    "predicates": {
                        "types": ["https://spdx.dev/Document", "https://cyclonedx.org/bom"]
                    },
                    "outputs": {
                        "files": {
                            "code": "sboms[0].get_node_list().get_nodes().filter(n, n.name == \"CONTRIBUTING.md\")"
                        }
                    },
                    "assessment": {
                        "message": "Found a CONTRIBUTING.md file"
                    },
                    "error": {
                        "message": "Repository has no CONTRIBUTING.md file",
                        "guidance": "Write up the project's contribution process into a CONTRIBUTING.md file and check it into the repository."
                    }
                }
            ]            
        },
        {
            "id": "OSPS-QA-01",
            "meta": {
                "description": "The project's source code and change history MUST be publicly readable at a static URL",
                "assert_mode": "AND",
                "controls": [
                    { "class": "OSPS", "id": "QA-01" }
                ]
            },
            "identities": [
                {
                    "sigstore": {
                        "mode": "exact",
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                   }
                }
            ],
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "github.repoDescriptorFromURI(predicate.data.materials[0].uri)"
                    }
                }
            ],
            "tenets": [
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/repo.yaml"]
                    },
                    "assessment": {
                        "message": "Found attested repository data"
                    }
                },
                {
                    "id": "01",
                    "code": "outputs[\"public\"]",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/repo.yaml"]
                    },
                    "outputs": {
                        "public": {
                            "code": "has(predicates[0].data.values.visibility) ? predicates[0].data.values.visibility == \"public\" : false"
                        }
                    },
                    "assessment": {
                        "message": "Code repository is public"
                    },
                    "error": {
                        "message": "Repository is private",
                        "guidance": "Enable public visibility in the repository settings"
                    }
                },
                {
                    "id": "02",
                    "code": "outputs[\"git\"] != ''",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/repo.yaml"]
                    },
                    "outputs": {
                        "git": {
                            "code": "has(predicates[0].data.values.git_url) ? predicates[0].data.values.git_url : '' "
                        }
                    },
                    "assessment": {
                        "message": "Code stored in git repository"
                    },
                    "error": {
                        "message": "No git repository found",
                        "guidance": "Ensure the project's code is available in git or other VCS"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-QA-02",
            "meta": {
                "description": "The project's version control system MUST require multi-factor authentication that does not include SMS ",
                "assert_mode": "OR",
                "controls": [
                    { "class": "OSPS", "id": "QA-02" }
                ]
            },
            "identities": [
                {
                    "sigstore": {
                        "mode": "exact",
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                   }
                }
            ],
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["https://spdx.dev/Document"]
                    },
                    "assessment": {
                        "message": "Found attested SBOM (SPDX)"
                    },
                    "error": {
                        "message": "No SPDX SBOM found",
                        "guidance": "Generate an SPDX SBOM from your code"
                    }
                },
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["https://cyclonedx.org/bom"]
                    },
                    "assessment": {
                        "message": "Found attested SBOM (CycloneDX)"
                    },
                    "error": {
                        "message": "No CycloneDX SBOM found",
                        "guidance": "Generate a CycloneDX SBOM from your code"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-BR-02",
            "meta": {
                "description": "Releases and released software assets MUST be assigned a unique version identifier",
                "enforce": "OFF",
                "controls": [ { "class": "OSPS", "id": "BR-02" } ],
                "assert_mode": "OR"
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "id": "01-sbom",
                    "predicates": {
                        "types": ["https://spdx.dev/Document", "https://cyclonedx.org/bom"]
                    },
                    "outputs": {
                        "versions": { "code": "sboms[0].get_node_list().get_root_nodes().map(s, s.version)" } 
                    },
                    "code": "outputs.versions.all(s, s != \"\")",
                    "assessment": {  "message": "All top level components have versions" },
                    "error": {
                        "message": "Som of the top level components in the SBOM are missing versions.",
                        "guidance": "Ensure the SBOM generation tool is capturing the release version."
                    }
                }
            ]            
        },
        {
            "id": "OSPS-BR-04",
            "meta": {
                "description": "When an official release is created, that release MUST contain a descriptive log of functional and security modifications.",
                "enforce": "OFF",
                "controls": [ { "class": "OSPS", "id": "BR-04" } ],
                "assert_mode": "OR"
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "id": "01-sbom",
                    "code": "size(outputs[\"files\"]) > 0",
                    "predicates": {
                        "types": ["https://spdx.dev/Document", "https://cyclonedx.org/bom"]
                    },
                    "outputs": {
                        "files": {
                            "code": "sboms[0].get_node_list().get_nodes().filter(n, (n.name == 'CHANGELOG' || n.name == 'changelog.txt' ))"
                        }
                    },
                    "assessment": {
                        "message": "Found a changelog in the project's SBOM."
                    },
                    "error": {
                        "message": "Could not detect a changelog file in the SBOM.",
                        "guidance": "Add a file named CHANGELOG to your project's codebase registering major changes."
                    }
                },
                {
                    "id": "01-si",
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "code": "outputs.changelog != '' ",
                    "outputs": {
                        "changelog": {
                            "code": "has(predicates[0].repository) ? (has(predicates[0].repository.release) ? (has(predicates[0].repository.release.changelog) ? predicates[0].repository.release.changelog : '') : '') : '' "
                        }
                    },
                    "assessment": {
                        "message": "Found a changelog entry in the project's security insights file."
                    },
                    "error": {
                        "message": "Could not detect a changelog file in the security insights file.",
                        "guidance": "Add a changelog entry to your SI file under repository.release.changelog"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-BR-05",
            "meta": {
                "description": "The project documentation MUST include an explanation of the contribution process.",
                "enforce": "OFF",
                "controls": [
                    { "class": "OSPS", "id": "BR-05" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "id": "01-lockfile",
                    "code": "size(outputs[\"files\"]) > 0",
                    "predicates": {
                        "types": ["https://spdx.dev/Document", "https://cyclonedx.org/bom"]
                    },
                    "outputs": {
                        "files": {
                            "code": "sboms[0].get_node_list().get_nodes().filter(n, (n.name == 'requirements.txt' || n.name == 'poetry.lock' || n.name == 'go.mod' || n.name == 'package.lock' || n.name == 'Gemfile.lock' ))"
                        }
                    },
                    "assessment": {
                        "message": "Found a package lock file"
                    },
                    "error": {
                        "message": "Could not detect a package lock file",
                        "guidance": "Ensure your project uses go, pypy, npm or ruby gems tooling o handle dependencies"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-BR-06",
            "meta": {
                "description": "Release MUST be signed or accounted for in a signed manifest",
                "assert_mode": "AND",
                "controls": [
                    { "class": "OSPS", "id": "BR-06" }
                ]
            },
            "tenets": [
                {
                    "id": "slsa",
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["https://slsa.dev/provenance/v0.2"]
                    },
                    "error": {
                        "message": "No SLSA attestation found",
                        "guidance": "Capture the build process in a SLSA provenance attestation"
                    },
                    "assessment": {
                        "message": "SLSA provenance attestation found"

                    }
                }
            ]            
        },
        {
            "id": "OSPS-DO-01",
            "meta": {
                "description": "The project documentation MUST provide user guides for all basic functionality",
                "assert_mode": "AND",
                "controls": [
                    { "class": "OSPS", "id": "DO-01" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "identities": [
                {
                    "sigstore": {
                        "mode": "exact",
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                   }
                }
            ],
            "tenets": [
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "error": {
                        "message": "No Security Insights attestation found",
                        "guidance": "Capture your security insights flile in an attestations at build point"
                    },
                    "assessment": {
                        "message": "Security Insights attestation found"

                    }
                },   
                {
                    "code": "outputs[\"docs\"] != \"\"",
                    "outputs": {
                        "docs": {
                            "code": "\"documentation\" in predicates[0].data.project ? (\"detailed-guide\" in predicates[0].data.project.documentation ? predicates[0].data.project.documentation[\"detailed-guide\"] : \"\" ) : \"\" "
                        }
                    },
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "assessment": {
                        "message": "Documentation link found in SECURITY_INSIGHTS.yaml"
                    },
                    "error": {
                        "message": "No documentation link found in SI",
                        "guidance": "Add a security insights file to your repository and define a documentation link"
                    }
                }
            ]            
        },
        {
            "id": "OSPS-DO-02",
            "meta": {
                "description": "The project MUST provide a mechanism for reporting defects.",
                "assert_mode": "AND",
                "controls": [
                    { "class": "OSPS", "id": "DO-02" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "identities": [
                {
                    "sigstore": {
                        "mode": "exact",
                        "issuer": "https://accounts.google.com",
                        "identity": "puerco@carabiner.dev"
                   }
                }
            ],
            "tenets": [
                {
                    "code": "size(predicates) > 0",
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "error": {
                        "message": "No Security Insights attestation found",
                        "guidance": "Capture your security insights file in an attestation at build point"
                    },
                    "assessment": {
                        "message": "Security Insights attestation found"

                    }
                },
                {
                    "code": "outputs[\"reporting\"]  ",
                    "outputs": {
                        "reporting": {
                            "code": "\"vulnerability-reporting\" in predicates[0].data.project ? (\"reports-accepted\" in predicates[0].data.project[\"vulnerability-reporting\"] ? predicates[0].data.project[\"vulnerability-reporting\"][\"reports-accepted\"]  : false  ) : false "
                        }
                    },
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "assessment": {
                        "message": "Project accepts vulnerability reports according to SECURITY_INSIGHTS.yml"
                    },
                    "error": {
                        "message": "No vulnerability reports found in SI",
                        "guidance": "Add a security insights file to your repository and define reports-accepted as true under vulnerability-reporting"
                    }
                },
                {
                    "code": "outputs[\"vulnerability-report-contact\"]  ",
                    "outputs": {
                        "vulnerability-report-contact": {
                            "code": "\"vulnerability-reporting\" in predicates[0].data.project ? (\"contact\" in predicates[0].data.project[\"vulnerability-reporting\"]  ) : false "
                        }
                    },
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "assessment": {
                        "message": "Vulnerability report contact found"
                    },
                    "error": {
                        "message": "No contact information found in SECURITY_INSIGHTS.yml",
                        "guidance": "Add contact data in the project's SECURITY_INSIGHTS.yml file, under vulnerability-reporting"
                    }
                }
            ]
        },
        {
            "id": "OSPS-DO-03",
            "meta": {
                "description": "Instructions to verify the integrity and authenticity of the release assets",
                "assert_mode": "AND",
                "enforce": "OFF",
                "controls": [
                    { "class": "OSPS", "id": "DO-03" }
                ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "id": "01-si",
                    "code": "outputs['verify'] != '' ",
                    "outputs": {
                        "verify": {
                            "code": "has(predicates[0].project) ? (has(predicates[0].project.documentation) ? ('signature-verification' in predicates[0].project.documentation ? predicates[0].project.documentation['signature-verification'] : '' ) : '' ) : '' "
                        }
                    },
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "assessment": {
                        "message": "Project accepts vulnerability reports according to SECURITY_INSIGHTS.yml"
                    },
                    "error": {
                        "message": "No vulnerability reports found in SI",
                        "guidance": "Add a security insights file to your repository and define reports-accepted as true under vulnerability-reporting"
                    }
                }
            ]
        },
        {
            "id": "OSPS-DO-04",
            "meta": {
                "description": "the project documentation MUST include a descriptive statement about the scope and duration of support",
                "enforce": "OFF",
                "controls": [ { "class": "OSPS", "id": "DO-04" } ]
            },
            "tenets": [
                {
                    "id": "01-openeox",
                    "predicates": {
                        "types": ["https://openeox.org/schema-0.2.0.json"]
                    },
                    "code": "size(predicates) > 0",
                    "assessment": {
                        "message": "Found an OpenEOX statement with the artifact's EOS."
                    },
                    "error": {
                        "message": "No OpenEOX data found.",
                        "guidance": "Capture the project End of Support in an OpenEOX file."
                    }
                }
            ]            
        },
        {
            "id": "OSPS-DO-05",
            "meta": {
                "description": "the project documentation MUST provide a descriptive statement when releases or versions will no longer receive security updates",
                "enforce": "OFF",
                "controls": [ { "class": "OSPS", "id": "DO-05" } ]
            },
            "tenets": [
                {
                    "id": "01-openeox",
                    "predicates": {
                        "types": ["https://openeox.org/schema-0.2.0.json"]
                    },
                    "code": "size(predicates) > 0",
                    "assessment": {
                        "message": "Found an OpenEOX statement with the artifact's EOL."
                    },
                    "error": {
                        "message": "No OpenEOX data found.",
                        "guidance": "Capture the project End of Life in an OpenEOX file."
                    }
                }
            ]
        },
        {
            "id": "OSPS-DO-06",
            "meta": {
                "description": "The project's documentation MUST include a description of how the project selects, obtains, and tracks its dependencies.",
                "enforce": "OFF",
                "controls": [ { "class": "OSPS", "id": "DO-06" } ]
            },
            "chain": [
                {
                    "predicate": {
                        "type": "https://slsa.dev/provenance/v0.2",
                        "selector": "predicate.data.materials[0]"
                    }
                }
            ],
            "tenets": [
                {
                    "id": "01-si",
                    "predicates": {
                        "types": ["https://github.com/ossf/security-insights-spec"]
                    },
                    "code": "outputs.deppolicy != '' ",
                    "outputs": {
                        "deppolicy": {
                            "code": "has(predicates[0].repository) ? (has(predicates[0].repository.documentation) ? (has(predicates[0].repository.documentation.dependency_management_policy) ? predicates[0].repository.documentation.dependency_management_policy : '') : '') : '' "
                        }
                    },
                    "assessment": {
                        "message": "Found a link to the projects dependency policy in the project's security insights file."
                    },
                    "error": {
                        "message": "Could not detect a link to the project's dependency policy in its security insights file.",
                        "guidance": "Add a changelog entry to your SI file under repository.documentation.dependency-management-policy."
                    }
                }
            ]            
        }
    ]
}
